<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - EventLink</title>
    <link rel="stylesheet" href="../css/SignUp.css">
</head>
<body>
    <div class="content">
        <p class="small-text">Start today!</p>
        <h1>Create an account</h1>
        <p class="small-text">Already have an account? <a href="SignIn.html">Sign in!</a></p>

        <form id="signup-form">
            <div class="name-fields">
                <input type="text" name="firstName" placeholder="First Name" required>
                <input type="text" name="lastName" placeholder="Last Name" required>
            </div>

            <input type="email" name="email" placeholder="Email" required>
            <div>
                <input type="password" name="password" placeholder="Password" required id="password">
                <span id="strengthFeedback" class="feedback"></span>
            </div>
            <div>
                <input type="password" name="confirmPassword" placeholder="Confirm Password" required id="confirmPassword">
                <span id="passwordFeedback" class="feedback"></span>
            </div>
            <button type="submit">Create Account</button>
        </form>
    </div>

    <script>
        function checkPasswordMatch() {
            const password = document.getElementById("password").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const feedback = document.getElementById('passwordFeedback');

            const xhttp = new XMLHttpRequest();
            xhttp.open("POST", "http://localhost:5000/users/checkPassword", true);
            xhttp.setRequestHeader("Content-Type", "application/json");
    
            xhttp.onload = function () {
                if (xhttp.status >= 200 && xhttp.status < 300) {
                    const response = JSON.parse(xhttp.responseText);
                    feedback.textContent = response.match ? 'Match' : 'No Match';
                } else {
                    feedback.textContent = 'Error checking password';
                }
            };
    
            xhttp.send(JSON.stringify({ password, confirmPassword }));
        }

        function checkPasswordStrength() {
            const password = document.getElementById('password').value;

            const feedback = document.getElementById('strengthFeedback');
            const xhttp = new XMLHttpRequest();
    
            xhttp.open("POST", "http://localhost:5000/users/checkPasswordStrength", true);
            xhttp.setRequestHeader("Content-Type", "application/json");
    
            xhttp.onload = function () {
                if (xhttp.status >= 200 && xhttp.status < 300) {
                    const response = JSON.parse(xhttp.responseText);
                    if (response.isStrong) {
                        feedback.textContent = 'Strong Password';
                    } else {
                        let errorMessage = 'Weak Password: ';
                        if (!response.hasCapital) errorMessage += 'Needs a capital letter. ';
                        if (!response.hasNum) errorMessage += 'Needs a number. ';
                        if (!response.isLongEnough) errorMessage += 'Needs to be at least 8 characters long.';
                        feedback.textContent = errorMessage;
                    }
                } else {
                    feedback.textContent = 'Error checking password strength';
                }
            };
    
            xhttp.send(JSON.stringify({ password }));
        }
    
        async function handleFormSubmit(event) {
            event.preventDefault();
    
            const form = event.target;
            const passwordFeedback = document.getElementById('passwordFeedback').textContent;
            const strengthFeedback = document.getElementById('strengthFeedback').textContent;
    
            if (passwordFeedback !== 'Match' || !strengthFeedback.includes('Strong Password')) {
                alert('Password must be strong and match the confirmation password.');
                return;
            }
    
            const data = {
                firstName: form.elements['firstName'].value,
                lastName: form.elements['lastName'].value,
                email: form.elements['email'].value,
                password: form.elements['password'].value
            };
    
            try {
                const response = await fetch('http://localhost:5000/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
    
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
    
                alert('Account created successfully!');
                window.location.href = 'HomePage.html';
                form.reset();
            } catch (error) {
                alert('An Account with this Email Already Exists!');
            }
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('signup-form');
            form.addEventListener('submit', handleFormSubmit);
    
            const passwordInput = document.getElementById('password');
            passwordInput.addEventListener('input', checkPasswordStrength);
    
            const confirmPasswordInput = document.getElementById('confirmPassword');
            confirmPasswordInput.addEventListener('input', checkPasswordMatch);
        });


                //or
       /* function handleFormSubmit(event) {
            event.preventDefault();
    
            var form = event.target;
            var formData = new FormData(form);
    
            var data = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                password: formData.get('password')
            };
    
            if (data.password !== formData.get('confirmPassword')) {
                alert('Passwords do not match.');
                return;
            }
    
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "http://localhost:5000/users", true);
            xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    
            xhttp.onload = function () {
                if (xhttp.status >= 200 && xhttp.status < 300) {
                    alert('Account created successfully!');
                    form.reset();
                } else {
                    alert('Error creating account: ' + xhttp.statusText);
                }
            };
    
            xhttp.send(JSON.stringify(data));
        }
    
        document.addEventListener('DOMContentLoaded', () => {
            var form = document.getElementById('signup-form');
            form.addEventListener('submit', handleFormSubmit);
    
            var confirmPasswordInput = document.getElementById('confirmPassword');
            confirmPasswordInput.addEventListener('input', checkPasswordMatch);
        });*/
    </script>
</body>
</html>
